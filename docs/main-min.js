let paymentState="credit",resultData={};function paymentBtnClicked(a){a.stopPropagation();let e=$(a.currentTarget);return $(".payment-btn").removeClass("active"),e.addClass("active"),e.hasClass("credit-btn")?(paymentState="credit",$(".select-line").removeClass().addClass("select-line").addClass("credit-line"),$(".payment-info-pane").removeClass("active"),$(".credit-pane").addClass("active"),setValidation(),void caculateTotal()):e.hasClass("shop-btn")?(paymentState="shop",$(".select-line").removeClass().addClass("select-line").addClass("shop-line"),$(".payment-info-pane").removeClass("active"),$(".shop-pane").addClass("active"),setValidation(),void caculateTotal()):e.hasClass("atm-btn")?(paymentState="atm",$(".select-line").removeClass().addClass("select-line").addClass("atm-line"),$(".payment-info-pane").removeClass("active"),$(".atm-pane").addClass("active"),setValidation(),void caculateTotal()):void 0}function caculateTotal(){var a=0,e=$(".side-pane .order li span").length,t=$(".side-pane .extra li span").length;$(".shop-pane").hasClass("active")?($(".extra").addClass("show"),a=e+t):($(".extra").removeClass("show"),a=e);let n=0;for(var i=0;i<a;i++){n+=parseInt($($(".side-pane li span")[i]).html())}$(".total").html(n)}function inputFocused(a){a.stopPropagation();let e=$(a.currentTarget);switch(e.removeClass("hint"),e.attr("id")){case"cardno":"0000-0000-0000-0000"==e.val()&&e.val("");break;case"month":"MM"==e.val()&&e.val("");break;case"year":"YYYY"==e.val()&&e.val("");break;case"cvv":"CVV"==e.val()&&e.val("")}}function inputFocusedOut(a){a.stopPropagation();let e=$(a.currentTarget);switch(e.attr("id")){case"cardno":""==e.val()&&(e.val("0000-0000-0000-0000"),e.addClass("hint"));break;case"month":""==e.val()&&(e.val("MM"),e.addClass("hint")),updateDateValidation();break;case"year":""==e.val()&&(e.val("YYYY"),e.addClass("hint")),updateDateValidation();break;case"cvv":""==e.val()&&(e.val("CVV"),e.addClass("hint"))}}function cardNumTweak(a){let e=$(a.currentTarget),t=e.val().split("-").join("");if(t.length>0){let a=getCardType(t);""!=a?($(".cardicon").text(a),$(".cardicon").css("visibility","visible")):$(".cardicon").css("visibility","hidden"),t=t.match(new RegExp(".{1,4}","g")).join("-")}e.val(t)}function getCardType(a){for(var e="",t=[{regEx:/^4/,cardType:"VISA"},{regEx:/^5[1-5]/,cardType:"MASTERCARD"},{regEx:/^3[47]/,cardType:"AMEX"},{regEx:/^35/,cardType:"JCB"}],n=0;n<t.length;n++)if(a.match(t[n].regEx)){e=t[n].cardType;break}return e}function luhnCheck(a){if(!/^[\d\-\s]+$/.test(a))return!1;for(var e=0,t=0,n=!1,i=a.replace(/\D/g,""),s=i.length-1;s>=0;s--){var l=i.charAt(s);t=parseInt(l,10),n&&(t*=2)>9&&(t-=9),e+=t,n=!n}return 0!==e&&e%10==0}function submitClicked(a){$(".payment-info>.active>form").submit()}function initValidation(){window.Parsley.addValidator("cardno",{validateString:function(a){var e=luhnCheck(a);return $(".cardicon").css("display",e?"block":"none"),e},messages:{en:"This is not a valid credit card number"}}),setValidation()}function setValidation(){$(".payment-info>.active>form").parsley().destroy(),$(".custom-error").html(""),$(".payment-info>.active>form").parsley().on("form:validate",function(a){if($(".payment-info>.active").hasClass("credit-pane")){var e=a.isValid({group:"date",force:!0});$(".date-validationResult").html(e?"":"expiration date is valid").toggleClass("filled",!e);var t=a.isValid();$(".form-item").css("margin-bottom",t?"20px":"10px")}e||(a.validationResult=!1)}).on("form:submit",function(){return!1}).on("form:success",function(){buildData(),showResult(),cleanup()})}function updateDateValidation(){var a=$(".payment-info>.active>form").parsley().isValid({group:"date",force:!0});$(".date-validationResult").html(a?"":"expiration date is valid").toggleClass("filled",!a)}function buildData(){var a=$(".payment-info-pane.active #email").val();switch($(".result-pane .result-email").html(a),paymentState){case"credit":var e=$(".payment-info-pane.active #cardno").val().toString().substr(-4),t=$("#cardtype").html();$(".lastfour").html(e+"  "+t);break;case"shop":var n=$("input[name='shop']:checked").val();$(".result-shop").html(n);break;case"atm":n="("+$("input[name='bank']:checked").val()+")";$(".result-bank").html(n)}}function showResult(){switch($(".result-info-pane").removeClass("active"),paymentState){case"credit":$(".credit-result").addClass("active");break;case"shop":$(".shop-result").addClass("active");break;case"atm":$(".atm-result").addClass("active")}parseInt($(window).width(),10)<=719&&(console.log("small. "),$(".mobile-submit").fadeOut(300)),$(".side-pane").fadeOut(300),$(".payment-pane").fadeOut(300,function(){$(".result-pane").fadeIn(400),$(".thankyou-deco-pane").fadeIn(400),$(".success").delay(1500).fadeOut(100)})}function cleanup(){for(var a=0;a<$(".payment-info-pane input").length;a++){var e=$($(".payment-info-pane input")[a]);switch(e.attr("id")){case"email":e.val("");break;case"cardno":e.val("0000-0000-0000-0000"),e.addClass("hint");break;case"month":e.val("MM"),e.addClass("hint");break;case"year":e.val("YYYY"),e.addClass("hint");break;case"cvv":e.val("CVV"),e.addClass("hint");break;case"shop-familymart":e.prop("checked",!0);break;case"shop-7-11":e.prop("checked",!1);break;case"bank-yusan":e.prop("checked",!0);break;case"bank-tw":case"bank-taishin":e.prop("checked",!1)}}$(".cardicon").html(""),$(".cardicon").css("visibility","hidden")}function backClicked(){$(".thankyou-deco-pane").fadeOut(300),$(".result-pane").fadeOut(300,function(){$(".payment-pane").fadeIn(400),$(".side-pane").fadeIn(400),parseInt($(window).width(),10)<=719&&$(".mobile-submit").fadeIn(400)})}function printClicked(){window.print()}$(document).ready(function(){$(".payment-btn").on("click",paymentBtnClicked),$("input").on("focus",inputFocused),$("input").on("focusout",inputFocusedOut),$("#cardno").on("keyup",cardNumTweak),$(".submit-btn").on("click",submitClicked),$(".back-btn").on("click",backClicked),$(".print-btn").on("click",printClicked),initValidation()});